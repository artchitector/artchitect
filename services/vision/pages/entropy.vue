<i18n>
{
  "en": {
    "title": "Artchitect - entropy"
  },
  "ru": {
    "title": "Artchitect - —ç–Ω—Ç—Ä–æ–ø–∏—è"
  }
}
</i18n>

<template>
  <section>
    <h1 class="is-size-3" v-if="locale === 'ru'">–î–∞—Ç—á–∏–∫ —ç–Ω—Ç—Ä–æ–ø–∏–∏</h1>
    <h1 class="is-size-3" v-else>Entropy sensor</h1>
    <hr/>
    <p v-if="locale === 'ru'">
      –î–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—É –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å "—á—Ç–æ —Ä–∏—Å–æ–≤–∞—Ç—å?" - –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –Ω–∞–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏
      —É–Ω–∏–∫–∞–ª—å–Ω—ã–π seed-–Ω–æ–º–µ—Ä. –î–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–∞ (–ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π)
      –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –¥–∞—Ç—á–∏–∫—É —ç–Ω—Ç—Ä–æ–ø–∏–∏ (—Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑ –≤–µ–±-–∫–∞–º–µ—Ä—ã), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑ —Å–≤–µ—Ç–æ–≤–æ–≥–æ —à—É–º–∞ –ø–æ–ª—É—á–∏—Ç—å
      float64-—á–∏—Å–ª–æ. <b>float64-—á–∏—Å–ª–æ</b> - —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –∫–∞–∂–¥–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≤ —Ä–∞–±–æ—Ç–µ Artchitect, –∞ –≤ –¥–µ–Ω—å –∏—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–µ—Å—è—Ç–∫–∏
      —Ç—ã—Å—è—á.
    </p>
    <p v-else>
      To draw arts Artchitect need know "what to draw?", it need to invent new keywords and a unique
      seed number. To be able to choose (make decisions), Artchitect is connected to an entropy sensor (made
      of a webcam), which allows Artchitect to receive a float64 number from light noise. <b>float64-number</b>>
      is the foundation of
      every choice in the work of Artchitect, and there are tens of thousands decisions per day.
    </p>
    <hr/>
    <p v-if="locale === 'ru'">
      <b>–®–∞–≥ 1. –ò—Å—Ö–æ–¥–Ω—ã–π –∫–∞–¥—Ä (Source)</b>
      <br/>
      –≠–Ω—Ç—Ä–æ–ø–∏—è (–≤ —Ñ–æ—Ä–º–µ —Å–≤–µ—Ç–æ–≤–æ–≥–æ —à—É–º–∞) –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∏–∑ —Ä–∞–∑–Ω–∏—Ü—ã –¥–≤—É—Ö —Å–æ—Å–µ–¥–Ω–∏—Ö –∫–∞–¥—Ä–æ–≤. –¢–µ–∫—É—â–∏–π –∫–∞–¥—Ä –≤–∏–¥–µ–Ω –Ω–∏–∂–µ, –µ–≥–æ
      —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ–≥–æ
      –∑–Ω–∞—á–µ–Ω–∏—è. –ö—Ä–∞—Å–Ω—ã–º –æ—Ç–º–µ—á–µ–Ω–∞ –æ–±–ª–∞—Å—Ç—å, —Å –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç —Å–Ω–∏–º–∞—Ç—å—Å—è —Ñ–æ–Ω–æ–≤—ã–π —à—É–º.
    </p>
    <p v-else>
      <b>Step 1. Original frame (Source)</b>
      <br/>
      Entropy (in the form of light noise) is obtained from the difference of two adjacent frames. The current frame is
      visible below, its content does not matter. The area from which background noise will be removed is marked in red.
    </p>
    <div class="has-text-centered">
      <img v-if="images.source !== null" :src="`data:image/jpeg;base64, ${images.source}`"
           alt="loading source stream"/>
    </div>
    <p v-if="locale === 'ru'">
      <b>–®–∞–≥ 2. –®—É–º (Noise)</b>
      <br/>
      –î–ª—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏ —Å–≤–µ—Ç–æ–≤–æ–≥–æ —à—É–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—ã—á–∏—Ç–∞–Ω–∏–µ –∫–∞–¥—Ä–æ–≤ (–∏–∑ —Ü–≤–µ—Ç–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –∫–∞–¥—Ä–∞ –≤—ã—á–∏—Ç–∞—é—Ç—Å—è —Ü–≤–µ—Ç–∞
      –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–∞–¥—Ä–∞). –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏ –∏ –µ—Å—Ç—å —Å–≤–µ—Ç–æ–≤–æ–π —à—É–º, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è. –í –≤–∏–∑—É–∞–ª—å–Ω–æ–º
      –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ —à—É–º –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
    </p>
    <p v-else>
      <b>Step 2. Noise</b>
      <br/>
      To extract light noise, frame subtraction is used (the colors of the current frame are subtracted from the colors
      of the previous frame). The difference between the frames is the light noise, which is further amplified. In the
      visual representation , the noise looks like this:
    </p>
    <div class="has-text-centered">
      <img v-if="images.noise !== null" :src="`data:image/jpeg;base64, ${images.noise}`"
           style="height: 256px; width: 256px;"
           alt="loading noise stream"/>
    </div>
    <p v-if="locale === 'ru'">
      <b>–®–∞–≥ 3. –≠–Ω—Ç—Ä–æ–ø–∏—è - —Å–∂–∞—Ç–∏–µ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —à—É–º–∞ (Entropy)</b>
      <br/>
      –®—É–º —Å–∂–∏–º–∞–µ—Ç—Å—è –¥–æ –æ–±–ª–∞—Å—Ç–∏ 8x8 –ø–∏–∫—Å–µ–ª–µ–π –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —à–∫–∞–ª–µ –æ—Ç 0 –¥–æ
      255). –¢–∞–∫ –∏ –≤—ã–≥–ª—è–¥–∏—Ç <b>–±–∞–∑–æ–≤–∞—è —ç–Ω—Ç—Ä–æ–ø–∏—è</b>, –∫–∞–∫ –µ—ë –≤–∏–¥–∏—Ç –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä.
    </p>
    <p v-else>
      <b>Step 3. Entropy - noise compression and normalization</b>
      <br/>
      The noise is compressed to an area of 8x8 pixels and normalized (distributed on a scale from 0 to 255). This is
      what the <b>basic entropy</b> looks like, as the Artchitect sees it.
    </p>
    <div class="has-text-centered">
      <img v-if="images.entropy !== null" :src="`data:image/png;base64, ${images.entropy}`"
           style="width: 64px; height: 64px; image-rendering: pixelated;" alt="loading entropy stream"/>
      <div>{{ entropy.float }}</div>
    </div>
    <p v-if="locale === 'ru'">
      <b>–®–∞–≥ 4. –ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —ç–Ω—Ç—Ä–æ–ø–∏—è (Choice)</b>
      <br/>
      –ß—Ç–æ–±—ã –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —Ä–∏—Å–æ–≤–∞–ª —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω—ã, –æ–Ω –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–±–æ—Ä–µ (–∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ –∏–ª–∏ seed-–Ω–æ–º–µ—Ä–∞) –¥–æ–ª–∂–µ–Ω
      –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ (–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –≤—ã–±–∏—Ä–∞—Ç—å –æ—á–µ–Ω—å —Ä–∞–∑–Ω—ã–µ —Å–ª–æ–≤–∞ –∏–∑ —Å–ª–æ–≤–∞—Ä—è –∫–∞–∂–¥—ã–π —Ä–∞–∑,
      –Ω–µ—á–∞—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä—è—è—Å—å).
      <br/>
      –ß—Ç–æ–±—ã
      –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ç–∞–∫—É—é —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —ç–Ω—Ç—Ä–æ–ø–∏—è –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –±–∏–Ω–∞—Ä–Ω–æ (–∫–∞–∂–¥—ã–π –±–∞–π—Ç –≤ —Ä–∏—Å—É–Ω–∫–µ —ç–Ω—Ç—Ä–æ–ø–∏–∏ –∑–µ—Ä–∫–∞–ª—å–Ω–æ
      –æ—Ç—Ä–∞–∂–∞–µ—Ç—Å—è). –ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —ç–Ω—Ç—Ä–æ–ø–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—á–µ–Ω—å —Å–ª—É—á–∞–π–Ω–æ–π –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ –≤—ã–±–∏—Ä–∞—Ç—å —Å–ª–æ–≤–∞
      –∏–∑ —Å–ª–æ–≤–∞—Ä—è.
    </p>
    <p v-else>
      <b>Step 4. Inverted entropy (Choice)</b>
      <br/>
      In order for Artchitect to draw a variety of pictures, it must ensure maximum diversity with each choice
      (keyword or seed number). Artchitect must choose very different words from the dictionary each time, rarely
      repeating itself.
      <br/>
      To ensure such selectivity, entropy is inverted binary (each byte in the entropy pattern is mirrored). The
      inverted entropy becomes very random and allows for evenly fair selection of words from the dictionary.
    </p>
    <div class="has-text-centered">
      <img v-if="images.choice !== null" :src="`data:image/png;base64, ${images.choice}`"
           style="width: 64px; height: 64px; image-rendering: pixelated;" alt="loading choice stream"/>
      <div>{{ choice.float }}</div>
    </div>
    <p v-if="locale === 'ru'">
      <b>–®–∞–≥ 5. –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —á–∏—Å–ª–æ</b>
      <br/>
      –ö–∞–∂–¥—ã–π –ø–∏–∫—Å–µ–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –≤–∫–ª—é—á–µ–Ω, –∏–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω (–∑–Ω–∞—á–µ–Ω–∏–µ –µ–≥–æ —Ü–≤–µ—Ç–∞ –±–ª–∏–∂–µ –∫ –∫—Ä–∞—Å–Ω–æ–º—É –∏–ª–∏ –∫ —á—ë—Ä–Ω–æ–º—É). –ö–∞–∂–¥—ã–π
      –ø–∏–∫—Å–µ–ª—å - —ç—Ç–æ –æ–¥–∏–Ω –±–∏—Ç –∏–∑ 64-–±–∏—Ç–Ω–æ–≥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞ (uint64). –ö–∞—Ä—Ç–∏–Ω–∫–∞ –ø–æ—Å–ª–µ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è
      uint64 —á–∏—Å–ª–æ–º –Ω–∞ —à–∫–∞–ª–µ –æ—Ç 0 –¥–æ 18446744073709551615. –ü–æ–ª–æ–∂–µ–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞ –Ω–∞ —ç—Ç–æ–π —à–∫–∞–ª–µ –∏ –µ—Å—Ç—å —Ç–æ—á–∫–∞
      –≤—ã–±–æ—Ä–∞.
      –î–∞–ª–µ–µ —à–∫–∞–ª–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ float64-—á–∏—Å–ª–æ, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–µ–µ —à–∫–∞–ª—É –≤—ã–±–æ—Ä–∞ - —ç—Ç–æ –¥—Ä–æ–±–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 0.0 –¥–æ 1.0, –≥–¥–µ 0 -
      —Å–∞–º—ã–π –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ —Å–ø–∏—Å–∫–µ, 1.0 - –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç, 0.5 - –ø—Ä–∏–º–µ—Ä–Ω–æ —Å–µ—Ä–µ–¥–∏–Ω–∞ —Å–ø–∏—Å–∫–∞.
    </p>
    <p v-else>
      <b>Step 5. Image to number conversion</b>
      <br/>
      Each pixel of 8x8-image is either on or off (its color value is closer to red or black). Each pixel is one bit of
      a 64-bit integer (uint64). The image after binary conversion becomes a uint64 number on a scale from 0 to
      18446744073709551615. The position of generated number on the scale is the point of choice. Next uint64 number
      become a float64-a number representing the selection scale from 0.0 to 1.0, where 0 is the
      very
      first element in the list, 1.0 is the last element, 0.5 is about the middle of the list.
    </p>
    <div class="columns">
      <div class="column has-text-centered">
        <img v-if="images.entropy !== null" :src="`data:image/png;base64, ${images.entropy}`"
             style="width: 64px; height: 64px; image-rendering: pixelated;" alt="loading entropy stream"/>
        <div class="is-size-7" v-html="entropy.bytes ? entropy.bytes.match(/.{1,8}/g).join('<br/>') : '-'"></div>
        <div>uint64: {{ entropy.int }}</div>
        <div>float64: <b>{{ entropy.float }}</b></div>
      </div>
      <div class="column has-text-centered">
        <img v-if="images.choice !== null" :src="`data:image/png;base64, ${images.choice}`"
             style="width: 64px; height: 64px; image-rendering: pixelated;" alt="loading choice stream"/>
        <div class="is-size-7" v-html="choice.bytes ? choice.bytes.match(/.{1,8}/g).join('<br/>') : '-'"></div>
        <div>uint64: {{ choice.int }}</div>
        <div>float64: <b>{{ choice.float }}</b></div>
      </div>
    </div>

  </section>
</template>

<script>

import WsConnection from "~/utils/ws_connection";

export default {
  name: "entropy",
  data() {
    return {
      player: null,
      logPrefix: "üéÜ",
      status: {
        error: null,
        reconnecting: null,
      },
      maintenance: false,
      connection: null,

      images: {
        source: null,
        noise: null,
        entropy: null,
        choice: null
      },
      entropy: {
        bytes: null,
        int: null,
        float: null,
      },
      choice: {
        bytes: null,
        int: null,
        float: null,
      }
    }
  },
  head() {
    return {
      title: this.$t('title')
    }
  },
  mounted() {
    if (process.env.SOUL_MAINTENANCE === 'true') {
      this.maintenance = true
      return
    }
    this.connection = new WsConnection(process.env.WS_URL, this.logPrefix, ['entropy'], 100)
    this.connection.onmessage((channel, message) => {
      this.status.error = null
      this.status.reconnecting = null
      this.onMessage(channel, message)
    })
    this.connection.onerror((err) => {
      this.status.error = err
    })
    this.connection.onreconnecting((attempt, maxAttempts) => {
      console.log(`${this.logPrefix}: RECONNECTING ${attempt}/${maxAttempts}`)
      this.status.reconnecting = {attempt, maxAttempts}
    })
    this.connection.onopen(() => {
      this.status.reconnecting = null
      this.status.error = null
    })
    this.connection.onopen(() => {
      this.status.reconnecting = null
      this.status.error = null
      console.log(`${this.logPrefix}: connection established`)
    })
    this.connection.connect()
  },
  beforeDestroy() {
    if (!this.maintenance) {
      this.connection.close()
      this.connection = null
    }
  },
  computed: {
    locale() {
      return this.$i18n.locale
    }
  },
  methods: {
    onMessage(chan, msg) {
      if (msg.Entropy) {
        this.entropy.bytes = msg.Entropy.Binary
        this.entropy.float = msg.Entropy.Float64
        this.entropy.int = msg.Entropy.Uint64
      } else {
        this.entropy.bytes = null
        this.entropy.float = null
        this.entropy.int = null
      }

      if (msg.Choice) {
        this.choice.bytes = msg.Choice.Binary
        this.choice.float = msg.Choice.Float64
        this.choice.int = msg.Choice.Uint64
      } else {
        this.choice.bytes = 0
        this.choice.float = 0
        this.choice.int = 0
      }

      for (const imageName in msg.ImagesEncoded) {
        this.images[imageName] = msg.ImagesEncoded[imageName]
      }
    }
  }
}
</script>


<style scoped lang="scss">

</style>
